(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{337:function(e,t,a){},338:function(e,t,a){},340:function(e,t,a){"use strict";a.r(t);var r=a(38),n=a.n(r),i=a(117),o=a.n(i),s=a(33),u=a(5),l=a(6),c=a(2),d=a(3),p=a(218),m=a(251),f=a(0),h=a(258),v=a(35),g=a(255),y=a(256),b=a(267),F=a(30),O=a(216),w=a(257),C=a(262),_=a(264),j=a(263),k=a(217),N=a(265),D=a(68),T=a(261),S=a(266),x=a(116),U=a(259),E=a(343),G=a(342),R=a(260);var A=function e(t,a){var r=function(t){return null!==t&&"object"===typeof t?e(t,a):a(t)};return Array.isArray(t)?t.map(r):"object"===typeof t?function(e,t){return Object.keys(e).reduce((function(a,r){return a[r]=t(e[r]),a}),{})}(t,r):t},I=a(253),M=a(254),V=(a(337),a(338),a(75));function L(e){var t="0123456789abcdef",a=parseInt(e);return isNaN(e)||0===a?"00":(a=Math.round(Math.min(Math.max(0,a),255)),t.charAt((a-a%16)/16)+t.charAt(a%16))}function H(e){return"#"===e.charAt(0)?e.substring(1,7):e}function J(e){var t=[];return t[0]=parseInt(H(e).substring(0,2),16),t[1]=parseInt(H(e).substring(2,4),16),t[2]=parseInt(H(e).substring(4,6),16),t}function q(e,t,a){if("nan"!==e)return a.indexOf(e)===t}var P=function(){function e(){Object(c.a)(this,e),this.params=void 0,this.eGui=void 0,this.eUpdateTime=void 0}return Object(d.a)(e,[{key:"init",value:function(e){this.params=e,this.eGui=document.createElement("div"),this.eGui.className="ag-status-name-value";var t=document.createElement("span");t.innerText="Last Refresh Time: ",this.eGui.appendChild(t),this.eUpdateTime=document.createElement("span"),this.eUpdateTime.className="ag-status-name-value-value",this.eGui.appendChild(this.eUpdateTime)}},{key:"getGui",value:function(){return this.eGui}},{key:"destroy",value:function(){}},{key:"updateTime",value:function(){var e=(new Date).toTimeString().slice(0,8);this.eUpdateTime.innerText=e+""}}]),e}(),B=function(e){Object(u.a)(a,e);var t=Object(l.a)(a);function a(e){var r,n=this;Object(c.a)(this,a),(r=t.call(this,e)).frameDtypes=void 0,r.api=void 0,r.columnApi=void 0,r.columnFormaters=void 0,r.manualUpdateRequested=!1,r.allowUnsafeJsCode=!1,r.fitColumnsOnGridLoad=!1,r.gridOptions=void 0,r.gradientLowValueColour="#FF0000",r.gradientHighValueColour="#00FF00",r.allValuesInTable=[],r.valuesForTableOrdered=[],r.wsUrl=void 0,r.rowIdCol=void 0,r.convertJavascriptCodeOnGridOptions=function(e){return A(e,r.convertStringToFunction)},r.render=function(){return void 0!==r.api&&r.state.should_update&&r.api.setRowData(r.state.rowData),r.loadColumnsState(),Object(V.jsxs)("div",{className:"ag-theme-"+r.props.args.theme,style:r.defineContainerHeight(),children:[Object(V.jsx)(n.ManualUpdateButton,{manual_update:r.manualUpdateRequested,onClick:function(e){return r.returnGridValue(e)}}),Object(V.jsx)(m.AgGridReact,{onGridReady:function(e){return r.onGridReady(e)},gridOptions:r.gridOptions})]})},f.ModuleRegistry.register(h.a),f.ModuleRegistry.register(F.d),e.args.custom_css&&function(e){var t=function(e){var t=[];for(var a in e){var r=a+" {";for(var n in e[a])r+=n+": "+e[a][n]+";";r+="}",t.push(r)}return t.join("\n")}(e),a=document.createElement("style");a.type="text/css",a.innerText=t,console.log("Adding cutom css: ",t),document.head.appendChild(a)}(e.args.custom_css),e.args.enable_enterprise_modules&&(f.ModuleRegistry.registerModules([w.a,g.a,y.a,O.a,C.a,_.a,j.a,k.a,N.a,D.c,T.a,S.a,x.a,U.a,b.a]),"license_key"in e.args&&v.b.setLicenseKey(e.args.license_key)),r.frameDtypes=r.props.args.frame_dtypes,r.manualUpdateRequested=1===r.props.args.manual_update,r.allowUnsafeJsCode=r.props.args.allow_unsafe_jscode,r.fitColumnsOnGridLoad=r.props.args.fit_columns_on_grid_load,r.wsUrl=r.props.args.websocket_connection_string,r.rowIdCol=r.props.args.row_id_col,r.state={rowData:JSON.parse(e.args.row_data),gridHeight:r.props.args.height,should_update:!1},r.initialiseValuesRequiredForConditionalFormatting(r.props.args.gridOptions,r.state.rowData),r.columnFormaters={columnTypes:{dateColumnFilter:{filter:"agDateColumnFilter",filterParams:{comparator:function(e,t){return Object(E.a)(Object(G.a)(t),e)}}},numberColumnFilter:{filter:"agNumberColumnFilter"},shortDateTimeFormat:{valueFormatter:function(e){return r.dateFormatter(e.value,"dd/MM/yyyy HH:mm")}},customDateFormat:{valueFormatter:function(e){return r.dateFormatter(e.value,"yyyy-MM-dd")}},customDateTimeFormat:{valueFormatter:function(e){return r.dateFormatter(e.value,e.column.colDef.custom_format_string)}},customNumericFormat:{valueFormatter:function(e){var t;return r.numberFormatter(e.value,null!==(t=e.column.colDef.precision)&&void 0!==t?t:2)}},customVolatilityFormat:{valueFormatter:function(e){var t;return r.volatilityFormatter(e.value,null!==(t=e.column.colDef.precision)&&void 0!==t?t:1)}},customCurrencyFormat:{valueFormatter:function(e){var t,a;return r.currencyFormatter(e.value,null!==(t=e.column.colDef.custom_currency_symbol)&&void 0!==t?t:"$",null!==(a=e.column.colDef.precision)&&void 0!==a?a:0)}},timedeltaFormat:{valueFormatter:function(e){return Object(I.duration)(e.value).humanize(!0)}},conditionalFormat:{cellStyle:function(e){return r.conditionalFormattingCellStyle(e.value,r.valuesForTableOrdered)}}}};var i=Object.assign({},r.columnFormaters,r.props.args.gridOptions);return r.allowUnsafeJsCode&&(console.warn("flag allow_unsafe_jscode is on."),i=r.convertJavascriptCodeOnGridOptions(i)),null!==r.rowIdCol&&(i.getRowId=function(e){return e.data[r.rowIdCol]}),null!==r.wsUrl&&(i.statusBar={statusPanels:[{statusPanel:P,key:"refreshTimeCompKey"}]}),r.gridOptions=i,r}return Object(d.a)(a,[{key:"initialiseValuesRequiredForConditionalFormatting",value:function(e,t){var a=this,r=e.columnDefs.filter((function(e){return e.type.includes("conditionalFormat")})).map((function(e){if(e.field)return e.field}));t.forEach((function(e){r.forEach((function(t){a.allValuesInTable.push(e[t])}))}));var n=this.allValuesInTable.filter(q);this.valuesForTableOrdered=n.sort((function(e,t){return e-t}))}},{key:"conditionalFormattingCellStyle",value:function(e,t){var a=t.indexOf(e);return{backgroundColor:"#"+function(e,t,a,r){var n,i,o=J(e),s=J(t),u=a,l=0,c=[];for(n=0;n<u;n++){var d=[];l+=1/u,d[0]=o[0]*l+(1-l)*s[0],d[1]=o[1]*l+(1-l)*s[1],d[2]=o[2]*l+(1-l)*s[2],c.push(L((i=d)[0])+L(i[1])+L(i[2]))}return c[r]}(this.gradientHighValueColour,this.gradientLowValueColour,this.valuesForTableOrdered.length,a)}}},{key:"convertStringToFunction",value:function(e){var t="--x_x--0_0--",a=new RegExp("".concat(t,"\\s*((function|class)\\s*.*)\\s*").concat(t)).exec(e);if(a){var r=a[1];return new Function("return "+r)()}return e}},{key:"attachUpdateEvents",value:function(e){var t=this,a=this.props.args.update_on[0],r=function(e){return t.returnGridValue(e)};a.forEach((function(t){Array.isArray(t)?(e.addEventListener(t[0],Object(M.debounce)(r,t[1])),console.log("Attached arr",t)):e.addEventListener(t,r)}))}},{key:"loadColumnsState",value:function(){var e=this.props.args.columns_state;null!=e&&this.columnApi.applyColumnState({state:e,applyOrder:!0})}},{key:"onGridReady",value:function(e){var t=this;for(var a in this.api=e.api,this.columnApi=e.columnApi,this.api.forEachDetailGridInfo((function(e){console.log(e)})),this.attachUpdateEvents(this.api),this.api.forEachDetailGridInfo((function(e){void 0!==e.api&&t.attachUpdateEvents(e.api)})),this.api.addEventListener("firstDataRendered",(function(e){return t.fitColumns()})),this.api.setRowData(this.state.rowData),this.gridOptions.preSelectedRows)this.api.selectIndex(this.gridOptions.preSelectedRows[a],!0,!0);null!==this.wsUrl&&this.wsUpdate(this.api)}},{key:"wsUpdate",value:function(e){new WebSocket(this.wsUrl).onmessage=function(t){var a=JSON.parse(t.data.replace(/\bNaN\b/g,"null"));e.applyTransactionAsync({update:a}),e.getStatusPanel("refreshTimeCompKey").updateTime()}}},{key:"fitColumns",value:function(){this.fitColumnsOnGridLoad?this.api.sizeColumnsToFit():this.columnApi.autoSizeAllColumns()}},{key:"dateFormatter",value:function(e,t){try{var a=Object(G.a)(e);return Object(R.a)(a,t)}catch(r){return e}}},{key:"currencyFormatter",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Number.parseFloat(e);return Number.isNaN(r)?e:t+r.toFixed(a).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}},{key:"numberFormatter",value:function(e,t){var a=Number.parseFloat(e);return Number.isNaN(a)?e:a.toFixed(t)}},{key:"volatilityFormatter",value:function(e,t){var a=Number.parseFloat(e);return Number.isNaN(a)?e:(100*a).toFixed(t)+"%"}},{key:"returnGridValue",value:function(e){var t=[];switch(this.props.args.data_return_mode){case 0:this.api.forEachLeafNode((function(e){return t.push(e.data)}));break;case 1:this.api.forEachNodeAfterFilter((function(e){e.group||t.push(e.data)}));break;case 2:this.api.forEachNodeAfterFilterAndSort((function(e){e.group||t.push(e.data)}))}var a={};this.api.forEachDetailGridInfo((function(e){var t;a[e.id]=[],null===(t=e.api)||void 0===t||t.forEachNode((function(t){t.isSelected()&&a[e.id].push(t)}))}));var r={originalDtypes:this.frameDtypes,rowData:t,selectedRows:this.api.getSelectedRows(),selectedItems:this.api.getSelectedNodes().map((function(e){return Object(s.a)({rowIndex:e.rowIndex},e.data)})),colState:this.columnApi.getColumnState()};p.a.setComponentValue(r)}},{key:"ManualUpdateButton",value:function(e){return e.manual_update?Object(V.jsx)("button",{onClick:e.onClick,children:"Update"}):Object(V.jsx)("span",{})}},{key:"defineContainerHeight",value:function(){return"domLayout"in this.gridOptions&&"autoHeight"===this.gridOptions.domLayout?{width:this.props.width}:{width:this.props.width,height:this.state.gridHeight}}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.args.reload_data?{rowData:JSON.parse(e.args.row_data),gridHeight:e.args.height,should_update:!0}:{gridHeight:e.args.height}}}]),a}(p.b),z=Object(p.c)(B);o.a.render(Object(V.jsx)(n.a.StrictMode,{children:Object(V.jsx)(z,{})}),document.getElementById("root"))}},[[340,1,2]]]);
//# sourceMappingURL=main.1bcf1371.chunk.js.map