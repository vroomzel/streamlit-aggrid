(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{335:function(t,e,r){},336:function(t,e,r){},338:function(t,e,r){"use strict";r.r(e);var a=r(37),n=r.n(a),o=r(116),i=r.n(o),u=r(32),s=r(2),l=r(3),c=r(5),d=r(6),p=r(217),m=r(250),f=r(0),h=r(257),v=r(34),g=r(254),y=r(255),F=r(215),b=r(256),O=r(261),w=r(263),C=r(262),_=r(216),j=r(264),k=r(67),D=r(260),N=r(265),S=r(115),x=r(258),A=r(341),I=r(340),R=r(259);var E=function t(e,r){var a=function(e){return null!==e&&"object"===typeof e?t(e,r):r(e)};return Array.isArray(e)?e.map(a):"object"===typeof e?function(t,e){return Object.keys(t).reduce((function(r,a){return r[a]=e(t[a]),r}),{})}(e,a):e},U=r(252),G=r(253),T=(r(335),r(336),r(74));function V(t){var e="0123456789abcdef",r=parseInt(t);return isNaN(t)||0===r?"00":(r=Math.round(Math.min(Math.max(0,r),255)),e.charAt((r-r%16)/16)+e.charAt(r%16))}function M(t){return"#"===t.charAt(0)?t.substring(1,7):t}function L(t){var e=[];return e[0]=parseInt(M(t).substring(0,2),16),e[1]=parseInt(M(t).substring(2,4),16),e[2]=parseInt(M(t).substring(4,6),16),e}function H(t,e,r){if("nan"!==t)return r.indexOf(t)===e}var J=function(t){Object(c.a)(r,t);var e=Object(d.a)(r);function r(t){var a,n=this;Object(s.a)(this,r),(a=e.call(this,t)).frameDtypes=void 0,a.api=void 0,a.columnApi=void 0,a.columnFormaters=void 0,a.manualUpdateRequested=!1,a.allowUnsafeJsCode=!1,a.fitColumnsOnGridLoad=!1,a.gridOptions=void 0,a.gradientLowValueColour="#FF0000",a.gradientHighValueColour="#00FF00",a.allValuesInTable=[],a.valuesForTableOrdered=[],a.wsUrl=void 0,a.rowIdCol=void 0,a.convertJavascriptCodeOnGridOptions=function(t){return E(t,a.convertStringToFunction)},a.render=function(){return void 0!==a.api&&a.state.should_update&&a.api.setRowData(a.state.rowData),a.loadColumnsState(),Object(T.jsxs)("div",{className:"ag-theme-"+a.props.args.theme,style:a.defineContainerHeight(),children:[Object(T.jsx)(n.ManualUpdateButton,{manual_update:a.manualUpdateRequested,onClick:function(t){return a.returnGridValue(t)}}),Object(T.jsx)(m.AgGridReact,{onGridReady:function(t){return a.onGridReady(t)},gridOptions:a.gridOptions})]})},f.ModuleRegistry.register(h.a),t.args.custom_css&&function(t){var e=function(t){var e=[];for(var r in t){var a=r+" {";for(var n in t[r])a+=n+": "+t[r][n]+";";a+="}",e.push(a)}return e.join("\n")}(t),r=document.createElement("style");r.type="text/css",r.innerText=e,console.log("Adding cutom css: ",e),document.head.appendChild(r)}(t.args.custom_css),t.args.enable_enterprise_modules&&(f.ModuleRegistry.registerModules([b.a,g.a,y.a,F.a,O.a,w.a,C.a,_.a,j.a,k.c,D.a,N.a,S.a,x.a]),"license_key"in t.args&&v.b.setLicenseKey(t.args.license_key)),a.frameDtypes=a.props.args.frame_dtypes,a.manualUpdateRequested=1===a.props.args.manual_update,a.allowUnsafeJsCode=a.props.args.allow_unsafe_jscode,a.fitColumnsOnGridLoad=a.props.args.fit_columns_on_grid_load,a.wsUrl=a.props.args.websocket_connection_string,a.rowIdCol=a.props.args.row_id_col,a.state={rowData:JSON.parse(t.args.row_data),gridHeight:a.props.args.height,should_update:!1},a.initialiseValuesRequiredForConditionalFormatting(a.props.args.gridOptions,a.state.rowData),a.columnFormaters={columnTypes:{dateColumnFilter:{filter:"agDateColumnFilter",filterParams:{comparator:function(t,e){return Object(A.a)(Object(I.a)(e),t)}}},numberColumnFilter:{filter:"agNumberColumnFilter"},shortDateTimeFormat:{valueFormatter:function(t){return a.dateFormatter(t.value,"dd/MM/yyyy HH:mm")}},customDateFormat:{valueFormatter:function(t){return a.dateFormatter(t.value,"yyyy-MM-dd")}},customDateTimeFormat:{valueFormatter:function(t){return a.dateFormatter(t.value,t.column.colDef.custom_format_string)}},customNumericFormat:{valueFormatter:function(t){var e;return a.numberFormatter(t.value,null!==(e=t.column.colDef.precision)&&void 0!==e?e:2)}},customVolatilityFormat:{valueFormatter:function(t){var e;return a.volatilityFormatter(t.value,null!==(e=t.column.colDef.precision)&&void 0!==e?e:1)}},customCurrencyFormat:{valueFormatter:function(t){var e,r;return a.currencyFormatter(t.value,null!==(e=t.column.colDef.custom_currency_symbol)&&void 0!==e?e:"$",null!==(r=t.column.colDef.precision)&&void 0!==r?r:0)}},timedeltaFormat:{valueFormatter:function(t){return Object(U.duration)(t.value).humanize(!0)}},conditionalFormat:{cellStyle:function(t){return a.conditionalFormattingCellStyle(t.value,a.valuesForTableOrdered)}}}};var o=Object.assign({},a.columnFormaters,a.props.args.gridOptions);return a.allowUnsafeJsCode&&(console.warn("flag allow_unsafe_jscode is on."),o=a.convertJavascriptCodeOnGridOptions(o)),null!==a.rowIdCol&&(o.getRowId=function(t){return t.data[a.rowIdCol]}),a.gridOptions=o,a}return Object(l.a)(r,[{key:"initialiseValuesRequiredForConditionalFormatting",value:function(t,e){var r=this,a=t.columnDefs.filter((function(t){return t.type.includes("conditionalFormat")})).map((function(t){if(t.field)return t.field}));e.forEach((function(t){a.forEach((function(e){r.allValuesInTable.push(t[e])}))}));var n=this.allValuesInTable.filter(H);this.valuesForTableOrdered=n.sort((function(t,e){return t-e}))}},{key:"conditionalFormattingCellStyle",value:function(t,e){var r=e.indexOf(t);return{backgroundColor:"#"+function(t,e,r,a){var n,o,i=L(t),u=L(e),s=r,l=0,c=[];for(n=0;n<s;n++){var d=[];l+=1/s,d[0]=i[0]*l+(1-l)*u[0],d[1]=i[1]*l+(1-l)*u[1],d[2]=i[2]*l+(1-l)*u[2],c.push(V((o=d)[0])+V(o[1])+V(o[2]))}return c[a]}(this.gradientHighValueColour,this.gradientLowValueColour,this.valuesForTableOrdered.length,r)}}},{key:"convertStringToFunction",value:function(t){var e="--x_x--0_0--",r=new RegExp("".concat(e,"\\s*((function|class)\\s*.*)\\s*").concat(e)).exec(t);if(r){var a=r[1];return new Function("return "+a)()}return t}},{key:"attachUpdateEvents",value:function(t){var e=this,r=this.props.args.update_on[0],a=function(t){return e.returnGridValue(t)};r.forEach((function(e){Array.isArray(e)?(t.addEventListener(e[0],Object(G.debounce)(a,e[1])),console.log("Attached arr",e)):t.addEventListener(e,a)}))}},{key:"loadColumnsState",value:function(){var t=this.props.args.columns_state;null!=t&&this.columnApi.applyColumnState({state:t,applyOrder:!0})}},{key:"onGridReady",value:function(t){var e=this;for(var r in this.api=t.api,this.columnApi=t.columnApi,this.api.forEachDetailGridInfo((function(t){console.log(t)})),this.attachUpdateEvents(this.api),this.api.forEachDetailGridInfo((function(t){void 0!==t.api&&e.attachUpdateEvents(t.api)})),this.api.addEventListener("firstDataRendered",(function(t){return e.fitColumns()})),this.api.setRowData(this.state.rowData),this.gridOptions.preSelectedRows)this.api.selectIndex(this.gridOptions.preSelectedRows[r],!0,!0);null!==this.wsUrl&&this.wsUpdate(this.api)}},{key:"wsUpdate",value:function(t){new WebSocket(this.wsUrl).onmessage=function(e){var r=JSON.parse(e.data);t.applyTransactionAsync({update:r})}}},{key:"fitColumns",value:function(){this.fitColumnsOnGridLoad?this.api.sizeColumnsToFit():this.columnApi.autoSizeAllColumns()}},{key:"dateFormatter",value:function(t,e){try{var r=Object(I.a)(t);return Object(R.a)(r,e)}catch(a){return t}}},{key:"currencyFormatter",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=Number.parseFloat(t);return Number.isNaN(a)?t:e+a.toFixed(r).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}},{key:"numberFormatter",value:function(t,e){var r=Number.parseFloat(t);return Number.isNaN(r)?t:r.toFixed(e)}},{key:"volatilityFormatter",value:function(t,e){var r=Number.parseFloat(t);return Number.isNaN(r)?t:(100*r).toFixed(e)+"%"}},{key:"returnGridValue",value:function(t){var e=[];switch(this.props.args.data_return_mode){case 0:this.api.forEachLeafNode((function(t){return e.push(t.data)}));break;case 1:this.api.forEachNodeAfterFilter((function(t){t.group||e.push(t.data)}));break;case 2:this.api.forEachNodeAfterFilterAndSort((function(t){t.group||e.push(t.data)}))}var r={};this.api.forEachDetailGridInfo((function(t){var e;r[t.id]=[],null===(e=t.api)||void 0===e||e.forEachNode((function(e){e.isSelected()&&r[t.id].push(e)}))}));var a={originalDtypes:this.frameDtypes,rowData:e,selectedRows:this.api.getSelectedRows(),selectedItems:this.api.getSelectedNodes().map((function(t){return Object(u.a)({rowIndex:t.rowIndex},t.data)})),colState:this.columnApi.getColumnState()};p.a.setComponentValue(a)}},{key:"ManualUpdateButton",value:function(t){return t.manual_update?Object(T.jsx)("button",{onClick:t.onClick,children:"Update"}):Object(T.jsx)("span",{})}},{key:"defineContainerHeight",value:function(){return"domLayout"in this.gridOptions&&"autoHeight"===this.gridOptions.domLayout?{width:this.props.width}:{width:this.props.width,height:this.state.gridHeight}}}],[{key:"getDerivedStateFromProps",value:function(t,e){return t.args.reload_data?{rowData:JSON.parse(t.args.row_data),gridHeight:t.args.height,should_update:!0}:{gridHeight:t.args.height}}}]),r}(p.b),q=Object(p.c)(J);i.a.render(Object(T.jsx)(n.a.StrictMode,{children:Object(T.jsx)(q,{})}),document.getElementById("root"))}},[[338,1,2]]]);
//# sourceMappingURL=main.66709da4.chunk.js.map